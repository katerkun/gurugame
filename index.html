<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle of Love - Official Download</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'VT323', monospace;
            background-color: #1a1a2e;
            overflow: hidden;
            margin: 0;
            padding: 0;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="white" stroke="%234a0e4e" stroke-width="2"><path d="M12 2L15 9L22 9L16 14L18 21L12 17L6 21L8 14L2 9L9 9Z"/></svg>'), auto; 
        }

        .immersive-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(15px) brightness(0.5);
            transform: scale(1.1); 
            z-index: 0;
            transition: background-image 1s ease-in-out;
        }

        .scene-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .aspect-ratio-box {
            position: relative;
            width: 100%;
            max-width: 3072px;
            aspect-ratio: 3072 / 1728;
            max-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .book-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.8s ease-in-out;
            z-index: 1;
        }

        .fx-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .magic-area {
            position: absolute;
            left: 50.78%;
            top: 47.39%;
            transform: translate(-50%, -50%);
            width: 60%; 
            height: 70%;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .float-book { animation: floatBook 6s ease-in-out infinite; }
        @keyframes floatBook {
            0%, 100% { transform: translateY(0%); }
            50% { transform: translateY(-1%); }
        }

        /* --- ESTILOS DEL "ULTRA SELLO" --- */
        .ghost-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: text;
            z-index: 50;
        }

        /* Anillos giratorios */
        .ring-slow { animation: spin 60s linear infinite; }
        .ring-med { animation: spin 20s linear infinite reverse; }
        .ring-fast { animation: spin 5s linear infinite; }
        
        /* Modificadores de velocidad según progreso */
        .speed-1 { animation-duration: 10s !important; }
        .speed-2 { animation-duration: 5s !important; }
        .speed-3 { animation-duration: 2s !important; }
        .speed-4 { animation-duration: 0.5s !important; }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Efecto de "Explosión" al escribir */
        .burst-ring {
            animation: burstAnim 0.6s ease-out forwards;
            transform-origin: center;
            opacity: 0;
        }
        @keyframes burstAnim {
            0% { transform: scale(0.8); opacity: 1; stroke-width: 5; }
            100% { transform: scale(2); opacity: 0; stroke-width: 0; }
        }

        /* Texto mágico */
        .rune-text {
            font-family: 'VT323', monospace;
            fill: #FFD700;
            text-shadow: 0 0 15px #FFD700, 0 0 30px #ff0000;
            filter: drop-shadow(0 0 5px #ff4500);
            animation: textAppear 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes textAppear {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .shake-error { animation: shakeError 0.5s ease-in-out; }
        @keyframes shakeError {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px) rotate(-5deg); filter: hue-rotate(90deg); }
            40%, 80% { transform: translateX(10px) rotate(5deg); }
        }

        /* Cursor mágico */
        .magic-cursor {
            fill: #FFD700;
            animation: blink 1s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; r: 5; } 50% { opacity: 0.5; r: 7; } }

        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkleAnim 2.5s infinite linear;
            opacity: 0;
        }
        @keyframes sparkleAnim {
            0% { transform: scale(0) translate(0, 0) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(0) translate(var(--tx), var(--ty)) rotate(180deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            .aspect-ratio-box { width: 95%; height: 80vh; aspect-ratio: auto; background: #fdf6e3; }
            .book-image { display: none; }
            .magic-area { width: 90%; height: 90%; left: 50%; top: 50%; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const IMG_CLOSED = "librocerrado.png"; 
        const IMG_OPENING = "libroabierto.png"; 
        const IMG_OPEN_BOOK = "libro.png"; 
        const AUDIO_BGM = "bgm.mp3"; 
        const FILE_DEMO = "CircleOfLove_Demo.zip";
        const FILE_BONUS = "CircleOfLove_Bonus.zip";

        // 1. CÍRCULO HEROICO (NIKE)
        const HeroicCircle = ({ onClick, isInvoking }) => (
            <div onClick={onClick} className={`relative cursor-pointer transition-all duration-700 flex items-center justify-center w-full h-full group`}>
                <div className={`relative w-[400px] h-[400px] md:w-[650px] md:h-[650px] transition-all duration-500 ${isInvoking ? 'scale-110 brightness-150' : 'hover:scale-105'}`}>
                    <svg viewBox="0 0 300 300" className="w-full h-full drop-shadow-[0_0_25px_rgba(255,69,0,0.5)]">
                        <defs>
                            <linearGradient id="fireGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#ffeb3b" />
                                <stop offset="50%" stopColor="#ff9800" />
                                <stop offset="100%" stopColor="#d63031" />
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <g className={isInvoking ? 'animate-[spin_1s_linear_infinite]' : 'animate-[spin_25s_linear_infinite]'}>
                            <circle cx="150" cy="150" r="145" fill="none" stroke="url(#fireGrad)" strokeWidth="1" strokeDasharray="15,5" />
                            <circle cx="150" cy="150" r="135" fill="none" stroke="#d63031" strokeWidth="0.5" opacity="0.6"/>
                            {[...Array(16)].map((_, i) => (
                                <path key={i} d="M138 5 L162 5 L150 20 Z" fill="#ff9800" transform={`rotate(${i * 22.5} 150 150)`} opacity="0.7" />
                            ))}
                        </g>
                        <g className={isInvoking ? 'animate-[spin_1s_linear_infinite_reverse]' : 'animate-[spin_12s_linear_infinite_reverse]'} style={{transformOrigin: '150px 150px'}}>
                            <path d="M150 20 L262 215 L38 215 Z" fill="none" stroke="url(#fireGrad)" strokeWidth="2" filter="url(#glow)" opacity="0.9"/>
                            <path d="M150 280 L38 85 L262 85 Z" fill="none" stroke="url(#fireGrad)" strokeWidth="2" filter="url(#glow)" opacity="0.9"/>
                        </g>
                        <g className={isInvoking ? 'animate-[spin_0.2s_linear_infinite]' : 'group-hover:animate-[spin_3s_linear_infinite]'} style={{transformOrigin: '150px 150px'}}>
                             <rect x="120" y="120" width="60" height="60" fill="none" stroke="#fff" strokeWidth="2" transform="rotate(45 150 150)" filter="url(#glow)"/>
                             <circle cx="150" cy="150" r="20" fill="#ffeb3b" className="animate-pulse" filter="url(#glow)" />
                        </g>
                    </svg>
                </div>
            </div>
        );

        // 2. CÍRCULO KUKURI
        const KukuriCircle = ({ onClick, isCollecting }) => (
            <div onClick={onClick} className={`relative cursor-pointer transition-all duration-700 flex items-center justify-center w-full h-full group`}>
                <div className={`relative w-[400px] h-[400px] md:w-[650px] md:h-[650px] ${isCollecting ? 'scale-110 opacity-80' : 'hover:scale-105'}`}>
                    <svg viewBox="0 0 300 300" className={`w-full h-full drop-shadow-[0_0_20px_rgba(255,105,180,0.5)] ${isCollecting ? 'animate-[spin_1s_linear_infinite]' : 'animate-[spin_40s_linear_infinite]'}`}>
                        <defs>
                            <linearGradient id="magicGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#ff7eb3" />
                                <stop offset="100%" stopColor="#7afcff" />
                            </linearGradient>
                        </defs>
                        <g opacity="0.5" className="text-purple-400">
                             {[...Array(12)].map((_, i) => (
                                <ellipse key={i} cx="150" cy="150" rx="30" ry="140" fill="none" stroke="currentColor" strokeWidth="1" transform={`rotate(${i * 15} 150 150)`} />
                            ))}
                        </g>
                        <circle cx="150" cy="150" r="120" fill="none" stroke="url(#magicGrad)" strokeWidth="3" />
                        <g className={isCollecting ? 'hidden' : 'animate-[spin_20s_linear_infinite_reverse]'} style={{transformOrigin: '150px 150px'}}>
                            <path d="M150 30 Q190 110 270 150 Q190 190 150 270 Q110 190 30 150 Q110 110 150 30" fill="none" stroke="#ff7eb3" strokeWidth="2" />
                        </g>
                        <circle cx="150" cy="150" r="10" fill="#fff" className="animate-pulse"/>
                    </svg>
                </div>
            </div>
        );

        // 3. SELLO COMPLEJO (Keyboard Enhanced)
        const EnhancedKeyboardSeal = ({ onSuccess }) => {
            const [inputValue, setInputValue] = useState("");
            const [isError, setIsError] = useState(false);
            const [burst, setBurst] = useState(null); // Para el efecto visual al teclear
            const inputRef = useRef(null);

            // Posiciones para las runas (Norte, Este, Sur, Oeste)
            const slots = [
                { x: 200, y: 100 }, 
                { x: 300, y: 200 }, 
                { x: 200, y: 300 }, 
                { x: 100, y: 200 }
            ];

            const handleChange = (e) => {
                if (isError) return;
                const val = e.target.value.toUpperCase().slice(0, 4);
                
                // Efecto de "Burst" si se añadió una letra
                if(val.length > inputValue.length) {
                    setBurst(val.length - 1);
                    setTimeout(() => setBurst(null), 500);
                }

                setInputValue(val);

                if (val.length === 4) {
                    if (val === "GURU") {
                        setTimeout(() => onSuccess(), 800);
                    } else {
                        setIsError(true);
                        setTimeout(() => {
                            setInputValue("");
                            setIsError(false);
                        }, 800);
                    }
                }
            };

            const handleClick = () => { if(inputRef.current) inputRef.current.focus(); };

            // Determina la velocidad de rotación según el progreso
            const speedClass = inputValue.length === 0 ? "" 
                             : inputValue.length === 1 ? "speed-1" 
                             : inputValue.length === 2 ? "speed-2" 
                             : inputValue.length === 3 ? "speed-3" 
                             : "speed-4";

            return (
                <div className={`w-full h-full flex flex-col items-center justify-center relative animate-[fadeIn_0.5s_ease-out]`} onClick={handleClick}>
                    
                    <input ref={inputRef} type="text" value={inputValue} onChange={handleChange} className="ghost-input" autoFocus autoComplete="off" />

                    <div className="relative w-[350px] h-[350px] md:w-[600px] md:h-[600px]">
                        <svg viewBox="0 0 400 400" className="w-full h-full drop-shadow-[0_0_15px_rgba(255,215,0,0.3)]">
                            <defs>
                                <radialGradient id="coreLight" cx="50%" cy="50%" r="50%">
                                    <stop offset="0%" stopColor="#fff" />
                                    <stop offset="100%" stopColor="#FFD700" stopOpacity="0" />
                                </radialGradient>
                            </defs>

                            {/* --- CAPAS DE FONDO ROTATORIAS --- */}
                            <g className={`origin-center ring-slow ${isError ? 'shake-error' : speedClass}`}>
                                {/* Anillo Rúnico Exterior */}
                                <circle cx="200" cy="200" r="180" fill="none" stroke="#4a0e4e" strokeWidth="1" strokeDasharray="5,15" opacity="0.6"/>
                                <circle cx="200" cy="200" r="170" fill="none" stroke="#d63031" strokeWidth="0.5" />
                                
                                {/* Anillo Medio (Geometría) */}
                                <g className="ring-med" opacity="0.4">
                                    <path d="M200 40 L360 200 L200 360 L40 200 Z" fill="none" stroke="#FFD700" strokeWidth="1" />
                                    <rect x="120" y="120" width="160" height="160" fill="none" stroke="#4a0e4e" strokeWidth="1" />
                                </g>
                            </g>

                            {/* --- NÚCLEO ACTIVO --- */}
                            {/* Crece con cada letra */}
                            <circle cx="200" cy="200" r={20 + (inputValue.length * 15)} fill="url(#coreLight)" opacity="0.3" className="transition-all duration-500" />
                            <circle cx="200" cy="200" r={10 + (inputValue.length * 10)} fill="none" stroke="#FFD700" strokeWidth="2" className={`ring-fast`} opacity="0.8"/>

                            {/* --- SLOTS Y LETRAS --- */}
                            {slots.map((pos, i) => {
                                const active = i < inputValue.length;
                                const isTarget = i === inputValue.length && !isError;
                                
                                return (
                                    <g key={i} transform={`translate(${pos.x}, ${pos.y})`}>
                                        
                                        {/* Efecto de Explosión al escribir */}
                                        {burst === i && (
                                            <circle r="40" fill="none" stroke="#FFD700" strokeWidth="2" className="burst-ring" />
                                        )}

                                        {/* Base del Slot */}
                                        <circle r="35" fill="rgba(0,0,0,0.3)" stroke={active ? "#FFD700" : "#4a0e4e"} strokeWidth={active ? 2 : 1} 
                                                className="transition-all duration-300" />
                                        
                                        {/* Decoración del Slot (Gira si está activo) */}
                                        <g className={active ? "ring-fast" : ""}>
                                            <rect x="-25" y="-25" width="50" height="50" fill="none" stroke={active ? "#FFD700" : "#4a0e4e"} 
                                                  strokeWidth="1" opacity={active ? 0.8 : 0.2} rx="5" />
                                        </g>

                                        {/* Cursor */}
                                        {isTarget && <circle r="5" className="magic-cursor" />}

                                        {/* Letra */}
                                        {active && (
                                            <text y="12" textAnchor="middle" fontSize="40" fontWeight="bold" className="rune-text origin-center">
                                                {inputValue[i]}
                                            </text>
                                        )}
                                    </g>
                                );
                            })}
                            
                            {/* Mensaje de Error (Grande en el centro) */}
                            {isError && (
                                <text x="200" y="215" textAnchor="middle" fill="#d63031" fontSize="100" fontWeight="bold" opacity="0.8" className="animate-pulse">ERROR</text>
                            )}

                        </svg>
                        
                        {/* Texto guía inferior */}
                        <div className="absolute bottom-4 w-full text-center pointer-events-none">
                             <p className="text-[#FFD700]/60 font-bold tracking-[0.5em] text-sm animate-pulse bg-black/20 inline-block px-4 py-1 rounded">
                                {inputValue.length === 0 ? "INVOCA: G U R U" : "..."}
                             </p>
                        </div>
                    </div>
                </div>
            );
        };

        const Sparkles = () => {
            const [particles, setParticles] = useState([]);
            useEffect(() => {
                const parts = Array.from({ length: 30 }).map((_, i) => ({
                    id: i,
                    left: Math.random() * 100 + '%',
                    top: Math.random() * 100 + '%',
                    tx: (Math.random() - 0.5) * 200 + 'px',
                    ty: (Math.random() - 1) * 200 + 'px',
                    delay: Math.random() * 2 + 's',
                    color: Math.random() > 0.6 ? '#FFD700' : '#ff7eb3',
                    size: Math.random() * 15 + 5 + 'px'
                }));
                setParticles(parts);
            }, []);
            return (
                <div className="fx-layer"> 
                    {particles.map(s => (
                        <div key={s.id} className="sparkle" style={{
                            left: s.left, top: s.top, '--tx': s.tx, '--ty': s.ty, 
                            animationDelay: s.delay, color: s.color, fontSize: s.size
                        }}>✨</div>
                    ))}
                </div>
            );
        };

        const App = () => {
            const [stage, setStage] = useState('closed'); 
            const [isPlaying, setIsPlaying] = useState(false);
            const [isInvoking, setIsInvoking] = useState(false);
            const [isCollecting, setIsCollecting] = useState(false);
            const audioRef = useRef(null);

            const currentBg = stage === 'closed' ? IMG_CLOSED : (stage === 'opening' ? IMG_OPENING : IMG_OPEN_BOOK);

            useEffect(() => {
                if (isPlaying && audioRef.current) {
                    audioRef.current.volume = 0.3;
                    audioRef.current.play().catch(e => console.log("Audio waiting"));
                }
            }, [isPlaying]);

            const handleStart = () => {
                if (stage === 'closed') {
                    setIsPlaying(true);
                    setStage('opening');
                    setTimeout(() => setStage('scene1'), 2500);
                }
            };

            const handleSpiralClick = () => {
                if (isInvoking) return;
                setIsInvoking(true);
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = FILE_DEMO; 
                    link.setAttribute('download', FILE_DEMO);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    setStage('seal'); 
                    setIsInvoking(false);
                }, 2000);
            };

            const handleSealSuccess = () => {
                 setStage('scene2');
            };

            const handleSecondDownload = () => {
                if (isCollecting) return;
                setIsCollecting(true);
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = FILE_BONUS; 
                    link.setAttribute('download', FILE_BONUS);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    setStage('closed');
                    setIsPlaying(false);
                    setIsCollecting(false);
                    if(audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current.currentTime = 0;
                    }
                }, 2000);
            };

            return (
                <div className="scene-container">
                    <audio ref={audioRef} src={AUDIO_BGM} loop />
                    <div className="immersive-bg" style={{ backgroundImage: `url(${currentBg})` }}></div>

                    <div className="aspect-ratio-box float-book">
                        <img src={IMG_CLOSED} className={`book-image ${stage === 'closed' ? 'opacity-100 cursor-pointer hover:brightness-110' : 'opacity-0 pointer-events-none'}`} onClick={handleStart} />
                        <img src={IMG_OPENING} className={`book-image ${stage === 'opening' ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} />
                        <img src={IMG_OPEN_BOOK} className={`book-image ${['scene1','seal','scene2'].includes(stage) ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} />

                        {stage !== 'closed' && <Sparkles />}

                        {['scene1', 'seal', 'scene2'].includes(stage) && (
                            <div className="magic-area">
                                {stage === 'scene1' && (
                                    <HeroicCircle onClick={handleSpiralClick} isInvoking={isInvoking} />
                                )}

                                {stage === 'seal' && (
                                    <EnhancedKeyboardSeal onSuccess={handleSealSuccess} />
                                )}

                                {stage === 'scene2' && (
                                    <KukuriCircle onClick={handleSecondDownload} isCollecting={isCollecting} />
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
