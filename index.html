<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle of Love - Official Download</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=VT323&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #ff7eb3;
            --color-secondary: #7afcff;
            --color-accent: #ffeb3b;
            --color-text: #4a0e4e;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: #1a1a2e;
            overflow: hidden;
            margin: 0;
            padding: 0;
            color: var(--color-text);
            /* Cursor m√°gico */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="white" stroke="%234a0e4e" stroke-width="2"><path d="M12 2L15 9L22 9L16 14L18 21L12 17L6 21L8 14L2 9L9 9Z"/></svg>'), auto; 
        }

        .handwritten {
            font-family: 'Indie Flower', cursive;
        }

        /* --- FONDO INMERSIVO (BLUR) --- */
        .immersive-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(15px) brightness(0.5);
            transform: scale(1.1); 
            z-index: 0;
            transition: background-image 1s ease-in-out;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .scene-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- CAJA DEL LIBRO (3072x1728 EXACTOS) --- */
        .aspect-ratio-box {
            position: relative;
            width: 100%;
            max-width: 3072px;
            aspect-ratio: 3072 / 1728;
            max-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }

        .book-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.8s ease-in-out;
        }

        /* --- √ÅREA USABLE (1560x819) --- 
           Calculado: 1560/3072 = 50.78% ancho | 819/1728 = 47.39% alto
           Centrado absolutamente sobre la imagen
        */
        .magic-area {
            position: absolute;
            width: 51%;  
            height: 48%;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Debug: border: 1px solid red; */ 
        }

        .float-book { animation: floatBook 6s ease-in-out infinite; }
        @keyframes floatBook {
            0%, 100% { transform: translateY(0%); }
            50% { transform: translateY(-1%); }
        }

        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkleAnim 2.5s infinite linear;
            opacity: 0;
        }
        @keyframes sparkleAnim {
            0% { transform: scale(0) translate(0, 0) rotate(0deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(0) translate(var(--tx), var(--ty)) rotate(180deg); opacity: 0; }
        }

        /* Input estilo M√≠stico */
        .mystic-input {
            border: none;
            border-bottom: 3px solid rgba(74, 14, 78, 0.5);
            background: transparent;
            text-align: center;
            font-family: 'VT323', monospace;
            color: #4a0e4e;
            font-weight: bold;
            font-size: 3.5rem;
            letter-spacing: 0.2em;
            outline: none;
            transition: all 0.3s;
            width: 100%;
            max-width: 500px;
        }
        .mystic-input:focus {
            border-bottom-color: #d63031;
            transform: scale(1.05);
        }
        .mystic-input::placeholder {
            color: rgba(74, 14, 78, 0.3);
            font-size: 2.5rem;
        }

        /* Efecto de Pulso para los c√≠rculos */
        .magic-pulse {
            animation: magicPulse 3s infinite ease-in-out;
        }
        @keyframes magicPulse {
            0% { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6)); }
            100% { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.3)); }
        }

        @media (max-width: 768px) {
            .aspect-ratio-box {
                width: 95%;
                aspect-ratio: auto;
                height: 80vh;
                background: #fdf6e3; /* Color papel */
                border-radius: 10px;
            }
            .book-image { display: none; }
            .magic-area {
                width: 90%;
                height: 90%;
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ASSETS ---
        // Aseg√∫rate de que los nombres coincidan con tu repositorio
        const IMG_CLOSED = "librocerrado.png"; 
        const IMG_OPENING = "libroabierto.png"; 
        const IMG_OPEN_BOOK = "libro.png"; 
        const AUDIO_BGM = "bgm.mp3"; 
        const FILE_DEMO = "CircleOfLove_Demo.zip";
        const FILE_BONUS = "CircleOfLove_Bonus.zip";

        // --- COMPONENTES VISUALES ---

        // 1. C√çRCULO "HEROICO" (Invocaci√≥n - Nuevo Dise√±o)
        // Estilo geom√©trico, tri√°ngulos, runas afiladas.
        const HeroicCircle = ({ onClick, isInvoking }) => (
            <div 
                onClick={onClick} 
                className={`relative cursor-pointer transition-all duration-700 w-full h-full flex items-center justify-center group ${isInvoking ? 'scale-110 brightness-125' : 'hover:scale-105'}`}
            >
                <div className={`relative w-[400px] h-[400px] md:w-[600px] md:h-[600px] magic-pulse transition-opacity duration-500 ${isInvoking ? 'opacity-100' : 'opacity-80 hover:opacity-100'}`}>
                    <svg viewBox="0 0 200 200" className="w-full h-full">
                        <defs>
                            <linearGradient id="heroGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#d63031" />
                                <stop offset="100%" stopColor="#4a0e4e" />
                            </linearGradient>
                        </defs>
                        
                        {/* Anillo Exterior R√∫nico (Gira lento) */}
                        <g className={isInvoking ? 'animate-[spin_1s_linear_infinite]' : 'animate-[spin_20s_linear_infinite]'}>
                            <circle cx="100" cy="100" r="95" fill="none" stroke="url(#heroGrad)" strokeWidth="1" strokeDasharray="10,5" />
                            <circle cx="100" cy="100" r="90" fill="none" stroke="#4a0e4e" strokeWidth="0.5" />
                            {/* Runas simuladas */}
                            {[...Array(8)].map((_, i) => (
                                <path key={i} d="M95 10 L105 10" stroke="#d63031" strokeWidth="2" transform={`rotate(${i * 45} 100 100)`} />
                            ))}
                        </g>

                        {/* Geometr√≠a Central (Tri√°ngulos Opuestos - Hexagrama) */}
                        <g className={isInvoking ? 'animate-[spin_2s_linear_infinite_reverse]' : 'animate-[spin_12s_linear_infinite_reverse]'} style={{transformOrigin: '100px 100px'}}>
                            <path d="M100 20 L170 140 L30 140 Z" fill="none" stroke="#d63031" strokeWidth="1.5" />
                            <path d="M100 180 L30 60 L170 60 Z" fill="none" stroke="#d63031" strokeWidth="1.5" />
                            <circle cx="100" cy="100" r="40" fill="none" stroke="#4a0e4e" strokeWidth="1" />
                        </g>

                        {/* N√∫cleo de Poder */}
                        <g className={isInvoking ? 'animate-[spin_0.5s_linear_infinite]' : 'group-hover:animate-[spin_4s_linear_infinite]'} style={{transformOrigin: '100px 100px'}}>
                             <rect x="85" y="85" width="30" height="30" fill="none" stroke="#FFD700" strokeWidth="2" transform="rotate(45 100 100)" />
                             <circle cx="100" cy="100" r="8" fill="#FFD700" className="animate-pulse" />
                        </g>
                    </svg>
                </div>
                
                {/* SIN TEXTO - Solo interacci√≥n visual */}
            </div>
        );

        // 2. C√çRCULO "KUKURI" (Final - Nuevo Dise√±o)
        // Estilo floral, curvo, suave, m√°gico.
        const KukuriCircle = ({ onClick, isCollecting }) => (
            <div 
                onClick={onClick} 
                className={`relative cursor-pointer transition-all duration-700 w-full h-full flex items-center justify-center group ${isCollecting ? 'scale-110 opacity-80' : 'hover:scale-105'}`}
            >
                <div className="relative w-[380px] h-[380px] md:w-[580px] md:h-[580px]">
                    <svg viewBox="0 0 200 200" className={`w-full h-full drop-shadow-xl ${isCollecting ? 'animate-[spin_0.5s_linear_infinite]' : 'animate-[spin_30s_linear_infinite]'}`}>
                        <defs>
                            <linearGradient id="kukuriGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" stopColor="#ff9a9e" />
                                <stop offset="100%" stopColor="#fecfef" />
                            </linearGradient>
                        </defs>

                        {/* P√©talos Exteriores */}
                        <g opacity="0.6">
                            {[...Array(6)].map((_, i) => (
                                <path key={i} d="M100 100 Q130 50 100 10 Q70 50 100 100" fill="url(#kukuriGrad)" transform={`rotate(${i * 60} 100 100)`} />
                            ))}
                        </g>

                        {/* C√≠rculos Conc√©ntricos Decorados */}
                        <circle cx="100" cy="100" r="80" fill="none" stroke="#ff69b4" strokeWidth="1" strokeDasharray="2,4" />
                        <circle cx="100" cy="100" r="70" fill="none" stroke="#FFD700" strokeWidth="0.5" />

                        {/* Corazones Giratorios */}
                        <g className={isCollecting ? 'hidden' : 'animate-[spin_10s_linear_infinite_reverse]'} style={{transformOrigin: '100px 100px'}}>
                            {[...Array(4)].map((_, i) => (
                                <path key={i} d="M100 45 C100 45 105 40 110 45 C115 50 100 60 100 60 C100 60 85 50 90 45 C95 40 100 45 100 45 Z" fill="#FFD700" transform={`rotate(${i * 90} 100 100)`} />
                            ))}
                        </g>

                        {/* Espiral Suave Central */}
                        <path 
                            d="M100 100 m -20 0 a 20 20 0 1 0 40 0 a 20 20 0 1 0 -40 0" 
                            fill="none" 
                            stroke="#fff" 
                            strokeWidth="3" 
                            strokeLinecap="round"
                            className="animate-pulse"
                        />
                    </svg>
                    
                    {/* Brillo Central */}
                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full blur-md animate-ping"></div>
                </div>
            </div>
        );

        // 3. SELLO M√ÅGICO (PASSWORD)
        const MagicSeal = ({ password, setPassword, onSubmit, error }) => (
            <div className="w-full flex flex-col items-center justify-center animate-[fadeIn_0.5s_ease-out]">
                <div className="mb-4 text-6xl animate-bounce">üîí</div>
                <h2 className="text-4xl text-[#4a0e4e] font-bold mb-6 font-serif">SELLO SAGRADO</h2>
                
                <form onSubmit={onSubmit} className="w-full flex flex-col items-center gap-4">
                    <input 
                        type="text" 
                        value={password} 
                        onChange={(e) => setPassword(e.target.value)} 
                        placeholder="PALABRA M√ÅGICA" 
                        className="mystic-input uppercase placeholder:italic"
                        autoFocus
                    />
                    
                    {error && (
                        <div className="text-[#d63031] font-bold text-xl mt-2 animate-shake">
                            ‚ö° PALABRA INCORRECTA ‚ö°
                        </div>
                    )}
                    
                    <p className="text-[#4a0e4e]/60 text-sm mt-4 font-bold">
                        (Presiona Enter para romper el sello)
                    </p>
                </form>
            </div>
        );

        const Sparkles = () => {
            const sparkles = Array.from({ length: 20 }).map((_, i) => ({
                id: i,
                left: Math.random() * 100 + '%',
                top: Math.random() * 100 + '%',
                tx: (Math.random() - 0.5) * 200 + 'px',
                ty: (Math.random() - 1) * 200 + 'px',
                delay: Math.random() * 2 + 's',
                color: Math.random() > 0.6 ? '#FFD700' : '#ff7eb3',
                size: Math.random() * 15 + 5 + 'px'
            }));
            return (
                <div className="absolute inset-0 pointer-events-none overflow-hidden z-30">
                    {sparkles.map(s => (
                        <div key={s.id} className="sparkle" style={{
                            left: s.left, top: s.top, '--tx': s.tx, '--ty': s.ty, 
                            animationDelay: s.delay, color: s.color, fontSize: s.size
                        }}>‚ú®</div>
                    ))}
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [stage, setStage] = useState('closed'); 
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isInvoking, setIsInvoking] = useState(false);
            const [isCollecting, setIsCollecting] = useState(false);
            const audioRef = useRef(null);
            const SECRET_CODE = "GURU"; 

            const currentBg = stage === 'closed' ? IMG_CLOSED : (stage === 'opening' ? IMG_OPENING : IMG_OPEN_BOOK);

            useEffect(() => {
                if (isPlaying && audioRef.current) {
                    audioRef.current.volume = 0.3;
                    audioRef.current.play().catch(e => console.log("Audio waiting for gesture"));
                }
            }, [isPlaying]);

            const handleStart = () => {
                if (stage === 'closed') {
                    setIsPlaying(true);
                    setStage('opening');
                    setTimeout(() => setStage('scene1'), 2500); // Espera a que termine la animaci√≥n de abrir
                }
            };

            const handleSpiralClick = () => {
                if (isInvoking) return;
                setIsInvoking(true);
                
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = FILE_DEMO; 
                    link.setAttribute('download', FILE_DEMO);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setStage('password');
                    setIsInvoking(false);
                }, 1500);
            };

            const handlePasswordSubmit = (e) => {
                e.preventDefault();
                if (password.toUpperCase() === SECRET_CODE) {
                    setError(false); setStage('scene2');
                } else {
                    setError(true); setTimeout(() => setError(false), 2000);
                }
            };

            const handleSecondDownload = () => {
                if (isCollecting) return;
                setIsCollecting(true);

                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = FILE_BONUS; 
                    link.setAttribute('download', FILE_BONUS);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Fin del ciclo
                    setStage('closed');
                    setIsPlaying(false);
                    setIsCollecting(false);
                    if(audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current.currentTime = 0;
                    }
                }, 1500);
            };

            return (
                <div className="scene-container">
                    <audio ref={audioRef} src={AUDIO_BGM} loop />

                    <div className="immersive-bg" style={{ backgroundImage: `url(${currentBg})` }}></div>

                    <div className="aspect-ratio-box float-book">
                        
                        <img src={IMG_CLOSED} className={`book-image ${stage === 'closed' ? 'opacity-100 cursor-pointer hover:brightness-110' : 'opacity-0 pointer-events-none'}`} onClick={handleStart} />
                        <img src={IMG_OPENING} className={`book-image ${stage === 'opening' ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} />
                        <img src={IMG_OPEN_BOOK} className={`book-image ${['scene1','password','scene2'].includes(stage) ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} />

                        {stage !== 'closed' && <Sparkles />}

                        {/* CONTENEDOR DE MAGIA (√ÅREA USABLE) */}
                        {['scene1', 'password', 'scene2'].includes(stage) && (
                            <div className="magic-area">
                                
                                {stage === 'scene1' && (
                                    <HeroicCircle onClick={handleSpiralClick} isInvoking={isInvoking} />
                                )}

                                {stage === 'password' && (
                                    <MagicSeal 
                                        password={password} 
                                        setPassword={setPassword} 
                                        onSubmit={handlePasswordSubmit} 
                                        error={error} 
                                    />
                                )}

                                {stage === 'scene2' && (
                                    <KukuriCircle onClick={handleSecondDownload} isCollecting={isCollecting} />
                                )}

                            </div>
                        )}
                    </div>

                    {stage === 'closed' && (
                        <div className="absolute bottom-12 animate-pulse z-50 pointer-events-none">
                            <span className="text-white/80 text-xl font-bold tracking-widest uppercase drop-shadow-lg">
                                [ Toca el Grimorio ]
                            </span>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
